<!DOCTYPE html>
<html lang="en">
  <script>
    if (localStorage.getItem('authenticated') !== 'true') {
      alert('You must be logged in to access this page.');
      window.location.href = 'login.html';
    }
    </script>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">   
    <title>Register</title>
    <div class = "header">
        <div class = "header-content">
            <div class = "header-text">
                <h1>Uncle Geri's Driving Academy</h1>
                <p>  804-251-0102</p>
            </div>
            <div class ="header-logo">
                <img src = "imgs/logo.png" alt="Logo">
            </div>
        </div>
        <nav class="navbar">
            <a href="courses.html"><button>Courses</button></a>
            <a href= "register.html"><button>Register</button></a>
            <a href="faq.html"><button>FAQs</button></a>
            <a href="connect.html"><button>Connect</button></a>
        </nav>    
    
    </div>
    
    </div>

</head>
<body>
    <div class="registrations">
      <div class="back-button-container">
        <button class="back-button" onclick="window.location.href='admin.html'">
            &#8592; Back to Admin Dashboard
        </button>
    </div>
      <h1>Messages</h1>
      <div class="row">
      <div class="student-grid" id="messageGrid"></div>
      <div class="student-details" id="detailsContainer"></div>
    </div>
    </div>
    <script>
      async function fetchMessages() {
        const backend = 'https://unclegeri-backend.onrender.com';
        const res = await fetch(`${backend}/messages`);
        console.log('Response status:', res.status);
        
        const data = await res.json();
        console.log('Data received:', data);
        if (!Array.isArray(data)) {
          console.error('Expected an array of messages, but received:', data);
          return;
        }
        const grid = document.getElementById('messageGrid');
        const details = document.getElementById('detailsContainer');
        
        grid.innerHTML = '';
        details.innerHTML = '';
        
        data.forEach(message => {
          const messageDiv = document.createElement('div');
          messageDiv.className = 'message-item';
          messageDiv.textContent = `${message.name} - ${message.email}`;
          messageDiv.onclick = () => showDetails(message);
          grid.appendChild(messageDiv);
        });
      }
      
      function showDetails(message) {
        const details = document.getElementById('detailsContainer');
        details.innerHTML = `
          <h2>Message Details</h2>
          <p><strong>Name:</strong> ${message.name}</p>
          <p><strong>Email:</strong> ${message.email}</p>
          <p><strong>Message:</strong> ${message.message}</p>
        `;
      }
      
      fetchMessages();
    </script>
</body>
<footer class="footer">
    <div class="footer-section">
        <h3>Learn More</h3>
        <a href="courses.html">Courses</a>
        <a href="faq.html">FAQs</a>
    </div>
    <div class="footer-section">
        <button onclick ="window.location.href='register.html'">Register Now!</button>
    </div>
    <div class="footer-section">
        <a href="connect.html" class="footer-icon">
            <img src="imgs/message.png" alt="Connect">
        </a>
    </div>
    <div class="footer-section">
        <a href="index.html" class="footer-icon">
            <img src="imgs/home.png" alt="Home">
        </a>
    </div>
    </div>
</footer>
</html>