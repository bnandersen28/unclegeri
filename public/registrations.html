<!DOCTYPE html>
<html lang="en">
  <script>
    if (localStorage.getItem('authenticated') !== 'true') {
      alert('You must be logged in to access this page.');
      window.location.href = 'login.html';
    }
    </script>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">   
    <title>Register</title>
    <div class = "header">
        <div class = "header-content">
            <div class = "header-text">
                <h1>Uncle Geri's Driving Academy</h1>
                <p>  804-251-0102</p>
            </div>
            <div class ="header-logo">
                <img src = "imgs/logo.png" alt="Logo">
            </div>
        </div>
        <nav class="navbar">
            <a href="courses.html"><button>Courses</button></a>
            <a href= "register.html"><button>Register</button></a>
            <a href="faq.html"><button>FAQs</button></a>
            <a href="connect.html"><button>Connect</button></a>
        </nav>    
    
    </div>
    
    </div>

</head>
<body>
    
    
    <body>
        <div class="registrations">
      <h1>Student Registrations</h1>
      <div class="row">
      <div class="student-grid" id="studentGrid"></div>
      <div class="student-details" id="detailsContainer">
        <p>.</p>
      </div>
      </div>
    </div>
      <script>
        async function fetchRegistrations() {
            const backend = 'https://unclegeri-backend.onrender.com';
            const res = await fetch(`${backend}/api/registrations`);
            console.log('Response status:', res.status);
          
          
            const data = await res.json();
            console.log('Data received:', data);
            
            if (!Array.isArray(data)) {
              console.error('Expected an array of registrations, but received:', data);
              return;
            }
          const grid = document.getElementById('studentGrid');
          const details = document.getElementById('detailsContainer');
    
          grid.innerHTML = `
             <p>${student.student_name}</p>
             <button class="delete-button" data-id="${student.id}">Delete</button>
             `; 
          details.innerHTML = '';

          data.forEach(student => {
            const card = document.createElement('div');
            card.className = 'student-card';
            

            card.onclick = () => {
              details.innerHTML = `
                <h2>${student.student_name}</h2>
                <p><strong>Start Date:</strong> ${student.start_date}</p>
                <p><strong>Start Time:</strong> ${student.start_time}</p>
                <p><strong>Course:</strong> ${student.course}</p>
                <p><strong>Parent:</strong> ${student.parent_name}</p>
                <p><strong>Phone:</strong> ${student.phone}</p>
                <p><strong>Parent Phone:</strong> ${student.parent_phone}</p>
                <p><strong>Email:</strong> ${student.email}</p>
                <p><strong>Parent Email:</strong> ${student.parent_email}</p>
                <p><strong>Address:</strong> ${student.home_address}</p>
                <p><strong>Permit Number:</strong> ${student.permit_number}</p>
                <p><strong>Acknowledged Policies:</strong> ${student.acknowledged_policies ? 'Yes' : 'No'}</p>
                <p><strong>Payment Method:</strong> ${student.payment_method || 'Not specified'}</p>
              `;
            };

            //Click event for delete button
            const deleteButton = card.querySelector('.delete-button');
            deleteButton.addEventListener('click',async(event)=>{
              event.stopPropagation();
              await deleteRegistration(student.id);
            });

            grid.appendChild(card);
          });
        }

        async function deleteRegistration(id){
          const backend = 'https://unclegeri-backend.onrender.com';

        if (!confirm('Are you sure you want to delete this registration?')) {
          return;
      }
      console.log(`Deleting registration with ID: ${id}`);
      
        // Make a DELETE request to the backend
      try {
          const res = await fetch(`${backend}/api/registrations/${id}`, {
              method: 'DELETE',
          });

            if (res.ok) {
                alert('Registration deleted successfully.');
                fetchRegistrations(); // Refresh the list after deletion
            } else {
                const errorData = await res.json();
                alert(`Failed to delete registration: ${errorData.message}`);
            }
        } catch (error) {
            console.error('Error deleting registration:', error);
            alert('An error occurred while deleting the registration.');
        }
}
    
        fetchRegistrations();
      </script>
    </body>
    <footer class="footer">
      <div class="footer-section">
          <h3>Learn More</h3>
          <a href="courses.html">Courses</a>
          <a href="faq.html">FAQs</a>
      </div>
      <div class="footer-section">
          <button onclick ="window.location.href='register.html'">Register Now!</button>
      </div>
      <div class="footer-section">
          <a href="connect.html" class="footer-icon">
              <img src="imgs/message.png" alt="Connect">
          </a>
      </div>
      <div class="footer-section">
          <a href="index.html" class="footer-icon">
              <img src="imgs/home.png" alt="Home">
          </a>
      </div>
      </div>
  </footer>
</html>




